name: Latest Blog Post Workflow
on:
  schedule:
    - cron: '0 * * * *' # Runs every hour, on the hour
  workflow_dispatch: # Run workflow manually

jobs:
  update-readme-with-blog-posts:
    name: Update README with the latest blog posts
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      # Fetch latest Hashnode blog posts
      - name: Fetch Hashnode Articles
        run: |
          hashnode_articles=$(curl -s https://leerenjie.hashnode.dev/rss.xml | grep -Eo '<item>.*?</item>' | sed -e 's/<[^>]*>//g')

      # Fetch latest FreeCodeCamp blog posts
      - name: Fetch FreeCodeCamp Articles
        run: |
          freecodecamp_articles=$(curl -s https://www.freecodecamp.org/news/author/lrj/rss/ | grep -Eo '<item>.*?</item>' | sed -e 's/<[^>]*>//g')

      # Update README with the fetched articles
      - name: Update README with Hashnode Articles
        run: |
          sed -i '/<!-- HASHNODE-BLOG-POST-LIST:START -->/,<!-- HASHNODE-BLOG-POST-LIST:END -->/c\
          <!-- HASHNODE-BLOG-POST-LIST:START -->\n'"$hashnode_articles"'\n<!-- HASHNODE-BLOG-POST-LIST:END -->' README.md

      - name: Update README with FreeCodeCamp Articles
        run: |
          sed -i '/<!-- FREECODECAMP-BLOG-POST-LIST:START -->/,<!-- FREECODECAMP-BLOG-POST-LIST:END -->/c\
          <!-- FREECODECAMP-BLOG-POST-LIST:START -->\n'"$freecodecamp_articles"'\n<!-- FREECODECAMP-BLOG-POST-LIST:END -->' README.md

      # Commit and push changes
      - name: Commit and Push Changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git commit -m "Update latest blog posts" || true
          git push
